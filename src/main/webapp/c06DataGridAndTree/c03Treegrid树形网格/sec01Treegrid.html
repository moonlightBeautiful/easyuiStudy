<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title> 树形网格（Treegrid）组件的学习</title>
    <link rel="stylesheet" type="text/css" href="../../jquery-easyui-1.7.0/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../jquery-easyui-1.7.0/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../jquery-easyui-1.7.0/demo/demo.css">
    <script type="text/javascript" src="../../jquery-easyui-1.7.0/jquery.min.js"></script>
    <script type="text/javascript" src="../../jquery-easyui-1.7.0/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../../jquery-easyui-1.7.0/locale/easyui-lang-zh_CN.js"></script>
</head>
<body>

<h2>基本 树形网格（Treegrid））组件</h2>
<div class="demo-info" style="font-size:20px;margin-bottom: 10px">
    <div class="demo-tip icon-tip"></div>
    <div>树形表格允许你展开和收缩多行组合.</div>
</div>
<div style="margin:10px 0;">
    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="collapseAll()">收缩所有</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="expandAll()">展开所有</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="expandTo()">展开到Database</a>
</div>
<div style="margin:10px 0;">
    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="edit()">编辑</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="save()">保存</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="cancel()">撤销</a>
</div>
<table id="tg" class="easyui-treegrid" style="width:700px;height:250px"
       data-options="
                iconCls: 'icon-ok',
                title:'文件浏览',
                animate: true,
                collapsible: true,
                fitColumns: true,
				url: './treegrid_data1.json',
				rownumbers: true,
				idField: 'id',
				treeField: 'name',
				showFooter: true,
				onContextMenu:onContextMenu
			">
    <thead>
    <tr>
        <th data-options="field:'name',editor:'text'">任务名称</th>
        <th data-options="field:'persons',align:'right',editor:'numberbox'">人员</th>
        <th data-options="field:'begin',width:180,editor:'datebox'">开始日期</th>
        <th data-options="field:'end',width:180,editor:'datebox'">结束日期</th>
        <th data-options="field:'progress',width:180,formatter:formatProgress,editor:'numberbox'">进度进度进度进度进度进度进度7
            进度太长了</th>
    </tr>
    </thead>
</table>

<div id="mm" class="easyui-menu" style="width:120px;">
    <div onclick="append()" data-options="iconCls:'icon-add'">添加</div>
    <div onclick="removeIt()" data-options="iconCls:'icon-remove'">删除</div>
    <div class="menu-sep"></div>
    <div onclick="collapse()">收缩</div>
    <div onclick="expand()">展开</div>
</div>


<script type="text/javascript">
    function formatProgress(value) {
        if (value) {
            var s = '<div style="width:100%;border:1px solid #ccc">' +
                '<div style="width:' + value + '%;background:#cc0000;color:#fff">' + value + '%' + '</div>'
            '</div>';
            return s;
        } else {
            return '';
        }
    }

    function collapseAll() {
        $('#tg').treegrid('collapseAll');
    }

    function expandAll() {
        $('#tg').treegrid('expandAll');
    }

    function expandTo() {
        $('#tg').treegrid('expandTo', 21).treegrid('select', 21);
    }

    function onContextMenu(e, row) {
        e.preventDefault();
        $(this).treegrid('select', row.id);
        $('#mm').menu('show', {
            left: e.pageX,
            top: e.pageY
        });
    }

    var idIndex = 100;

    function append() {
        idIndex++;
        var d1 = new Date();
        var d2 = new Date();
        d2.setMonth(d2.getMonth() + 1);
        var node = $('#tg').treegrid('getSelected');
        $('#tg').treegrid('append', {
            parent: node.id,
            data: [{
                id: idIndex,
                name: 'New Task' + idIndex,
                persons: parseInt(Math.random() * 10),
                begin: $.fn.datebox.defaults.formatter(d1),
                end: $.fn.datebox.defaults.formatter(d2),
                progress: parseInt(Math.random() * 100)
            }]
        })
    }

    function removeIt() {
        var node = $('#tg').treegrid('getSelected');
        if (node) {
            $('#tg').treegrid('remove', node.id);
        }
    }

    function collapse() {
        var node = $('#tg').treegrid('getSelected');
        if (node) {
            $('#tg').treegrid('collapse', node.id);
        }
    }

    function expand() {
        var node = $('#tg').treegrid('getSelected');
        if (node) {
            $('#tg').treegrid('expand', node.id);
        }
    }

    var editingId = undefined;

    function edit() {
        if (editingId != undefined) {
            $('#tg').treegrid('select', editingId);
            $.messager.alert('提示','请点击保存按钮保存正在编辑的节点，再点击编辑按钮编辑新的节点');
            return;
        }
        var row = $('#tg').treegrid('getSelected');
        if (row) {
            editingId = row.id
            $('#tg').treegrid('beginEdit', editingId);
        }else{
            $.messager.alert('提示','请选中节点，再点击编辑按钮');
        }
    }

    function save() {
        if(editingId == undefined){
            $.messager.alert('提示','没有需要保存的节点');
            return;
        }
        if (editingId != undefined) {
            var t = $('#tg');
            t.treegrid('endEdit', editingId);
            editingId = undefined;
            var persons = 0;
            var rows = t.treegrid('getChildren');
            for (var i = 0; i < rows.length; i++) {
                var p = parseInt(rows[i].persons);
                if (!isNaN(p)) {
                    persons += p;
                }
            }
            var frow = t.treegrid('getFooterRows')[0];
            frow.persons = persons;
            t.treegrid('reloadFooter');
        }
    }
    function cancel() {
        if (editingId != undefined) {
            $('#tg').treegrid('cancelEdit', editingId);
            editingId = undefined;
        }
    }


</script>
<hr>
<div class="demo-info" style="font-size:20px;margin-top:10px">
    <div class="demo-tip icon-tip"></div>
    <div>树形网格（Treegrid）组件get：</div>
</div>
<div style="font-size:18px">
    <ol>
        <li>简介：以多列形式显示分层网格数据</li>
        <li>用法：
            <ol>
                <li>标记table中使用class创建一个属性网格'easyui-treegrid'。</li>
                <li>在空标记table使用 js 创建一个属性网格$('#pg').treegrid({})。</li>
            </ol>
        </li>
        <li>依赖：datagrid。</li>
        <li>属性：
            <ol>
                <li>（必须）idField：string，标识树节点的字段。</li>
                <li>（必须）treeField：string，树节点的标题文本字段，有折叠展开按钮，展现层次，要与左边第一个th的field的值相等。其他节点没有折叠展开按钮</li>
                <li>（必须）url：string，返回数据为json，属性分析：
                    <ol>
                        <li>（必须）total：int，总数量。</li>
                        <li>（必须）rows：jsonArray，构造树形结构数据。json属性如下：
                            <ol>
                                <li>（必须）与idField和treeField属性对应的2个字段：string。</li>
                                <li>（可选）_parentId：string，总父节点id值。</li>
                                <li>（可选）state：string，节点是否展开，'open' 或 'closed'，默认是 'open'。</li>
                                <li>（可选）iconCls：string，树节点的标题图标的 css class。</li>
                            </ol>
                        </li>
                        <li>（可选）footer：json，表尾。默认不会显示，需要配合showFooter属性使用。</li>
                    </ol>
                </li>
                <li>（继承）showFooter：boolean，默认值false。是否显示表尾。</li>
                <li>（继承）title：string，树形网格面板标题文本，如果不设定或者设定为空字符串，则标题栏不显示，即使设置了标题图标，也不会显示标题栏。</li>
                <li>（继承）iconCls：string，树形网格面板标题图标。</li>
                <li> animate：boolean，默认值为false。当节点展开折叠时是否显示动画效果。</li>
                <li>（继承）collapsible：boolean，默认值false，是否显示折叠按钮。</li>
                <li>（继承）fitColumns：boolean，默认值false，是否自动扩大或缩小列的尺寸以适应（填充满）网格的宽度并且防止水平滚动。
                    <ul>
                        <li>fitColumns:true生效，依据列width来重新结算此列的宽度以填充满网格的宽度，所以至少要为一列指定宽度。</li>
                        <li>如果列width都没有指定，列宽取列标题宽度或者此列内容宽度的最大值。可能出现水平滑动或者未填充满网格。</li>
                        <li>如果列width全部指定，则依据列width来重新结算此列的宽度以填充满网格的宽度。 列标题或者单元格内容过长，则可能过长部分不会被显示。</li>
                        <li>如果列width部分指定，未指定的列，列宽取列标题宽度或者此列内容宽度的最大值。指定的列重新结算此列的宽度以填充满网格的宽度。</li>
                    </ul>
                </li>
                <li>（继承，属性）rownumbers：boolean，默认值false，是否显示序号。</li>
                <li>（继承，列属性）formatter：function(value：单元格值,rowData：行值。rowIndex：行索引)，格式化列数据。</li>
                <li>（继承，列属性）field：string，列的字段名，和加载的数据的jason对象的属性匹配起来。</li>
                <li>（继承，列属性）align：string，默认值是left，如何对齐列数据，可能的值：'left'、'right'、'center'。</li>

            </ol>
        </li>
        <li>事件
            <ol>
                <li>onContextMenu：e,row。当右击节点时触发。</li>
            </ol>
        </li>
        <li>方法：
            <ol>
                <li>collapseAll：none，折叠所有的节点。</li>
                <li>expandAll：none，展开所有的节点。</li>
                <li>expandTo：id，从根部展开到指定的节点，指定的节点没有被选中，仅仅展开状态。</li>
                <li>（继承）select：id，选中节点。</li>
                <li>（继承）getSelected：none，获取选中的节点并返回它，如果没有选中节点则返回 null。</li>
                <li>append：param{parent:父节点的id,data:[{节点json}]}，追加一些子节点到一个父节点，parent如果没有分配到正确的父节点id，则追加为根节点。。</li>
                <li>remove：id。移除节点和它的子节点。</li>
                <li>collapse：id。折叠节点。</li>
                <li>expand：id。展开节点。</li>
                <li>（继承）beginEdit：id。开始编辑节点。</li>
                <li>（继承）endEdit：id。结束编辑节点。（会自动调用acceptChanges接受改变）。</li>
                <li>（继承）cancelEdit：id。取消编辑节点。</li>
                <li>（继承）getFooterRows：none，返回底部的行。</li>
                <li>（继承）reloadFooter：footer(也就是jsonArray)，重新加载底部的行。</li>
                <li>getChildren：id。获取子节点。</li>
                <li>getParent：id。获取父节点。</li>
                <li>insert：param({before/after：id，data：[{新的节点数据}]})。指定节点的前边或者后边插入的节。</li>
            </ol>
        </li>
    </ol>
</div>
parseInt(String) js 解析一个字符串，并返回一个整数。
Date对象有setMonth方法
</body>
</html>
