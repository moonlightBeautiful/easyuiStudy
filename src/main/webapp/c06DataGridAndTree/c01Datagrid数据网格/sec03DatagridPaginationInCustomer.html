<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>基本数据网格（Datagrid）组件的学习</title>
    <link rel="stylesheet" type="text/css" href="../../jquery-easyui-1.7.0/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../jquery-easyui-1.7.0/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../jquery-easyui-1.7.0/demo/demo.css">
    <script type="text/javascript" src="../../jquery-easyui-1.7.0/jquery.min.js"></script>
    <script type="text/javascript" src="../../jquery-easyui-1.7.0/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../../jquery-easyui-1.7.0/locale/easyui-lang-zh_CN.js"></script>
</head>
<body>

<h2>数据表格客户端分页</h2>
<div class="demo-info" style="font-size:20px;margin-bottom: 10px">
    <div class="demo-tip icon-tip"></div>
    <div>这个示例教我们如何在客户端实现数据表格分页.</div>
</div>

<table id="dg" title="客户端分页" style="width:700px;height:300px" data-options="
				rownumbers:true,
				singleSelect:true,
				autoRowHeight:false,
				pagination:true,
				pageSize:10">
    <thead>
    <tr>
        <th field="inv" width="80">月份</th>
        <th field="date" width="100">日期</th>
        <th field="name" width="80">姓名</th>
        <th field="amount" width="80" align="right">数量</th>
        <th field="price" width="80" align="right">价格</th>
        <th field="cost" width="100" align="right">费用</th>
        <th field="note" width="110">备注</th>
    </tr>
    </thead>
</table>
<script>
    function getData() {
        var rows = [];
        for (var i = 1; i <= 800; i++) {
            var amount = Math.floor(Math.random() * 1000);
            var price = Math.floor(Math.random() * 1000);
            rows.push({
                inv: i + '月',
                date: $.fn.datebox.defaults.formatter(new Date()),
                name: '姓名 ' + i,
                amount: amount,
                price: price,
                cost: amount * price,
                note: '备注 ' + i
            });
        }
        return rows;
    }

    function pagerFilter(data) {
        if (typeof data.length == 'number' && typeof data.splice == 'function') {	// is array
            data = {
                total: data.length,
                rows: data
            }
        }
        var dg = $(this);
        var opts = dg.datagrid('options');
        var pager = dg.datagrid('getPager');
        pager.pagination({
            onSelectPage: function (pageNum, pageSize) {
                opts.pageNumber = pageNum;
                opts.pageSize = pageSize;
                pager.pagination('refresh', {
                    pageNumber: pageNum,
                    pageSize: pageSize
                });
                dg.datagrid('loadData', data);
            }
        });
        if (!data.originalRows) {
            data.originalRows = (data.rows);
        }
        var start = (opts.pageNumber - 1) * parseInt(opts.pageSize);
        var end = start + parseInt(opts.pageSize);
        data.rows = (data.originalRows.slice(start, end));
        return data;
    }

    $(function () {
        $('#dg').datagrid({loadFilter: pagerFilter}).datagrid('loadData', getData());
    });
</script>

<hr>
<div class="demo-info" style="font-size:20px;margin-top:10px">
    <div class="demo-tip icon-tip"></div>
    <div>数据网格（Datagrid）组件get：</div>
</div>
<div style="font-size:18px">
    <ol>提示：
        <li>loadFilter：function，过滤器，过滤数据网格的数据。该函数有一个参数 'data'，表示原始数据。必须返回标准数据对象，含有 'total' 和 'rows' 属性。</li>
        <li>loadData：data，加载本地数据，旧的行会被移除。可以ajax获取后塞给变量，再加载。</li>
    </ol>
</div>

</body>
</html>
